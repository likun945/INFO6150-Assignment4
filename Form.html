<!doctype html>
<html lang="en">

<head>
	<title>Feedback</title>
	<style>
		label {
			float: left;
			width: 150px;
		}

		#container {
			width: 900px;
			margin: auto;
			background-color: beige;
		}

		#tableContainer {
			margin-top: 20px;
		}
		main {
			padding: 50px;
		}

		.error {
			color: red;
			margin-left: 15px;
		}

		.btns {
			margin-top: 25px;
		}

		#checkboxContainer {
			overflow-y: auto;
		}

		table {
			width: 60%;
			border-collapse: collapse;
			margin: 20px auto;
			table-layout: auto;

		}

		th,
		td {
			padding: 8px 16px;
			border: 1px solid #ccc;
			text-align: left;
			white-space: nowrap;
		}

		th {
			background-color: #f2f2f2;
		}

		tr:nth-child(even) {
			background-color: #f9f9f9;
		}

		tr:hover {
			background-color: #ddd;
		}

		#customDiv {
			margin-top: 10px;
			width: 100%;
			overflow: auto;
		}
	</style>
</head>

<body>
	<div id="container">

		<main>
			<h2>Feeback</h2>
			<h3>Love something? Hate something? Let us know!</h3>
			Note : Fields marked with an asterisk(*) are mandatory
			<br><br>
			<form method="post" id="feedbackForm" novalidate onsubmit="collectFormData(event)">
				<label>Title*:</label>
				<div id="radioGroup">
					<input type="radio" name="title" id="miss" value="Miss" required="required" />Miss
					<input type="radio" name="title" id="mr" value="Mr." required="required" />Mr.
					<input type="radio" name="title" id="mrs" value="Mrs." required="required" />Mrs.
				</div>
				<br><br>
				<label for="firstName">First Name*:</label>
				<input type="text" name="firstName" id="firstName" placeholder="First Name" />
				<br><br>


				<label for="lastName">Last Name*:</label>
				<input type="text" name="lastName" id="lastName" placeholder="Last Name" />
				<br><br>


				<label for="emailId">Email*:</label>
				<input type="text" name="emailId" id="emailId" placeholder="yourname@domain.com" />
				<br><br>


				<label for="phoneNumber">Phone Number*:</label>
				<input type="text" name="phoneNumber" id="phoneNumber" placeholder="xxx-xxx-xxxx" />
				<br><br>

				<label for="city">City*:</label>
				<input type="text" name="city" id="city" placeholder="City" />
				<br><br>

				<label for="state">State*:</label>
				<input type="text" name="state" id="state" placeholder="State" />
				<br><br>


				<label for="address1">Street Address 1*:</label>
				<input type="text" name="address1" id="address1" placeholder="123 Main St" />
				<br><br>
				<div>
					<label for="address2">Street Address 2</label>
					<input type='text' name="address2" placeholder="160 exchange st" />
				</div>
				<br />

				<label for="zipcode">ZipCode*:</label>
				<input type="text" name="zipcode" id="zipcode" placeholder="xxxxxx" />
				<br><br>
				<label for="zipcode">How did you hear*:</label>
				<div id="sourceGroup">
					<input type='checkbox' name="source" value="facebook" /> Facebook
					<input type='checkbox' name="source" value="google" /> Google
					<input type='checkbox' name="source" value="yelp" /> Yelp
				</div>

				<br><br>

				<label for="comments">Comments*:</label>
				<textarea name="comments" id="comments" placeholder="Your comments" rows="5" cols="25"></textarea>
				<br><br>
				<div>
					<label for="singleSelect">Choose a drink*:</label>
					<select id="singleSelect" name="drink" onChange="handleSelectChange(event)">
						<option value="" disabled selected>Select a drink option</option>
						<option value="coffee">Coffee</option>
						<option value="tea">Tea</option>
						<option value="soda">Soda</option>
						<option value="juice">Juice</option>
						<option value="water">Water</option>
					</select>
				</div>
				<div id="checkboxContainer"></div>
				<br />
				<div class="btns">
					<input type="submit" id="submitButton">
					<input type="reset">
				</div>
				<br><br>
			</form>
		</main>
	</div>
	<div id="tableContainer">
		<table id="mytable" style="display: none; margin-top:15px;">
			<thead>
				<tr>
					<th>Name</th>
					<th>Email</th>
					<th>Phone number</th>
					<th>Street Address 1</th>
					<th>Street Address 2</th>
					<th>City</th>
					<th>State</th>
					<th>Zip Code</th>
					<th>Source</th>
					<th>Comments</th>
					<th>Drink</th>
					<th>Drink options</th>
					<th>Drink Notes</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>

	<script>

		function createTable(data) {
			var table = document.getElementById('mytable');
			var tableBody = table.querySelector('tbody');

			var row = document.createElement('tr');
			var cel1 = document.createElement('td');
			var cel2 = document.createElement('td');
			var cel3 = document.createElement('td');
			var cel4 = document.createElement('td');
			var cel5 = document.createElement('td');
			var cel6 = document.createElement('td');
			var cel7 = document.createElement('td');
			var cel8 = document.createElement('td');
			var cel9 = document.createElement('td');
			var cel10 = document.createElement('td');
			var cel11 = document.createElement('td');
			var cel12 = document.createElement('td');
			var cel13 = document.createElement('td');
			cel1.textContent = data.title + ' ' + data.firstName + ' ' + data.lastName;
			cel2.textContent = data.emailId;
			cel3.textContent = data.phoneNumber;
			cel4.textContent = data.address1;
			cel5.textContent = data.address2;
			cel6.textContent = data.city;
			cel7.textContent = data.state;
			cel8.textContent = data.zipcode;
			var source = '';
			for (let i = 0; i < data.source.length; i++) {
				source += data.source[i] + ','
			}
			cel9.textContent = data.source;
			cel10.textContent = data.comments;
			cel11.textContent = data.drink;
			var options = ''
			for (let i = 0; i < data.options.length; i++) {
				options += data.options[i] + ','
			}
			cel12.textContent = options.slice(0, -1);
			cel13.textContent = data['drink custom'];
			console.log(data);
			row.appendChild(cel1);
			row.appendChild(cel2);
			row.appendChild(cel3);
			row.appendChild(cel4);
			row.appendChild(cel5);
			row.appendChild(cel6);
			row.appendChild(cel7);
			row.appendChild(cel8);
			row.appendChild(cel9);
			row.appendChild(cel10);
			row.appendChild(cel11);
			row.appendChild(cel12);
			row.appendChild(cel13);
			tableBody.appendChild(row);
			table.style.display = 'initial';
		}

		function collectFormData(event) {
			event.preventDefault();
			var form = document.getElementById('feedbackForm');
			var formData = new FormData(form);
			var formObject = {};
			var options_note = [];
			var source = [];
			formData.forEach((value, key, i) => {
				if (key.startsWith("_")) {
					options_note.push(key.substring(1).toLowerCase());
				}
				else if (key === 'source') {
					source.push(value);
				}
				else {
					formObject[key] = value;
				}
			});
			formObject['options'] = options_note;
			formObject['source'] = source;
			createTable(formObject);
			event.target.reset();
			var submitButton = document.getElementById('submitButton');
			submitButton.disabled = true;
		}
		function handleSelectChange(event) {
			var selectedOption = event.target.value;
			var checkboxContainer = document.getElementById('checkboxContainer');
			checkboxContainer.innerHTML = '';
			const arr = [
				{
					key: 'coffee',
					items: [
						'Large', 'Medium', 'Small', 'Extra Shot', 'Soy Milk'
					]
				},
				{
					key: 'Tea',
					items: [
						'Large', 'Medium', 'Small', 'Lemon', 'Honey'
					]
				},
				{
					key: 'Soda',
					items: [
						'Large', 'Medium', 'Small', 'Ice', 'No Ice'
					]
				},
				{
					key: 'Juice',
					items: [
						'Large', 'Medium', 'Small', 'Chilled', 'Room Temperature'
					]
				},
				{
					key: 'Water',
					items: [
						'Large', 'Medium', 'Small', 'Chilled', 'Room Temperature'
					]
				}
			];

			const element = arr.find((ele) => ele.key.toLowerCase() === selectedOption);
			if (element) {
				element.items.forEach(item => {
					var checkboxLabel = document.createElement('label');
					var checkbox = document.createElement('input');
					checkbox.type = 'checkbox';
					checkbox.name = '_' + item;
					checkbox.id = item;
					checkboxLabel.htmlFor = item;
					checkboxLabel.appendChild(document.createTextNode(item));
					checkboxLabel.appendChild(checkbox);
					checkboxContainer.appendChild(checkboxLabel);
					checkbox.addEventListener('change', function () {
						var customTextField = document.getElementById('customTextField');
						var customLabel = document.getElementById('customLabel');
						var submitButton = document.getElementById('submitButton');
						var customDiv = document.getElementById('customDiv');
						if (checkbox.checked && !customLabel && !customTextField) {
							customTextField = document.createElement('input');
							customLabel = document.createElement('label');
							customDiv = document.createElement('div');
							customLabel.id = 'customLabel';
							customTextField.type = 'text';
							customTextField.name = 'drink custom';
							customTextField.id = 'customTextField';
							customLabel.textContent = 'Notes*'
							customDiv.id = 'customDiv';
							customDiv.appendChild(customLabel);
							customDiv.appendChild(customTextField);
							checkboxContainer.appendChild(customDiv)
							customTextField.addEventListener('keyup', () => {
								window.updateSubmitButtonState();
							})
						}
						else if (!checkbox.checked) {
							//  && customTextField
							var checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
							var isChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
							if (!isChecked) {
								customDiv.remove();
							}
						}
						window.updateSubmitButtonState();
					})
				});
			}
		}
		document.addEventListener('DOMContentLoaded', (event) => {
			var alphanumeric = /^[0-9a-zA-Z]+$/;
			var emailRegex = /^[a-zA-Z0-9._-]+@northeastern\.edu$/;
			var phoneRegex = /^\d{3}-\d{3}-\d{4}$/;
			var zipRegex = /^\d{5}(?:-\d{4})?$/;

			var form = document.getElementById('feedbackForm');
			var submitButton = document.getElementById('submitButton');
			var customTextField = document.getElementById('customTextField');
			window.updateSubmitButtonState = updateSubmitButtonState;
			function isRadioGroupValid() {
				var radios = document.querySelectorAll('#radioGroup input[type="radio"]');
				var anyChecked = Array.from(radios).some(radio => radio.checked);
				return anyChecked;
			}
			function isCheckboxGroupValid() {
				var checkboxes = document.querySelectorAll('#sourceGroup input[type="checkbox"]');
				var anyChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
				return anyChecked;
			}

			function validateCheckboxGroup() {
				var anyChecked = isCheckboxGroupValid();
				var errorElement = document.getElementById('sourceError');

				if (!anyChecked) {
					if (!errorElement) {
						errorElement = document.createElement('span');
						errorElement.className = 'error';
						errorElement.id = 'sourceError';
						document.getElementById('sourceGroup').appendChild(errorElement);
					}
					errorElement.textContent = 'Please select at least one option.';
				} else if (errorElement) {
					errorElement.remove();
				}

				updateSubmitButtonState();
				return anyChecked;
			}
			document.querySelectorAll('#sourceGroup input[type="checkbox"]').forEach(checkbox => {
				checkbox.addEventListener('change', validateCheckboxGroup);
			});

			document.querySelector('#singleSelect').addEventListener('change', () => {
				updateSubmitButtonState();
			})
			function validateField(fieldElement) {
				var regex, minLength, maxLength;
				switch (fieldElement.id) {
					case 'firstName':
					case 'lastName':
						regex = alphanumeric;
						minLength = 1;
						maxLength = 50;
						example = "e.g., JohnDoe";
						break;
					case 'emailId':
						regex = emailRegex;
						minLength = 4;
						maxLength = 255;
						example = "e.g., example@northeastern.edu";
						break;
					case 'phoneNumber':
						regex = phoneRegex;
						minLength = 12;
						maxLength = 12;
						example = "e.g., 123-456-7890";
						break;
					case 'zipcode':
						regex = zipRegex;
						minLength = 5;
						maxLength = 10;
						example = "e.g., 12345 or 12345-6789";
						break;
					case 'comments':
						regex = /^[\s\S]{5,500}$/;
						minLength = 5;
						maxLength = 500;
						example = "";  // No example needed for comments
						break;
					case 'address1':
						regex = /^[0-9a-zA-Z\s]+$/;
						minLength = 1;
						maxLength = 100;
						example = "e.g., 123 Main St";
						break;
					case 'city':
						regex = /^[a-zA-Z\s]+$/;
						minLength = 1;
						maxLength = 50;
						example = "e.g., Boston";
						break;

					case 'state':
						regex = /^[a-zA-Z\s]+$/;
						minLength = 2;
						maxLength = 2;
						example = "e.g., MA";
						break;
					default:
						return true;
				}
				var value = fieldElement.value;
				var isValid = value && value.length >= minLength && value.length <= maxLength && regex.test(value);
				var errorElement = fieldElement.nextElementSibling;

				if (!isValid) {
					if (!errorElement || errorElement.className !== 'error') {
						errorElement = document.createElement('span');
						errorElement.className = 'error';
						fieldElement.parentNode.insertBefore(errorElement, fieldElement.nextSibling);
					}
					errorElement.textContent = `Required (${minLength} to ${maxLength} characters) ${example}`;
				} else if (errorElement && errorElement.className === 'error') {
					errorElement.remove();
				}

				updateSubmitButtonState();
				return isValid;
			}

			function updateSubmitButtonState() {
				var anyErrors = Array.from(form.querySelectorAll('input, textarea, select')).some(field => {
					if (field.type === 'submit' || field.type === 'reset' || field.name === 'address2') {
						return false;  // Skip the submit button
					}
					var errorElement = field.nextElementSibling;
					var isEmpty = field.value.trim() == '';
					return isEmpty || (errorElement && errorElement.className === 'error');
				});
				var checkValid = isCheckboxGroupValid();
				var radioValid = isRadioGroupValid();
				submitButton.disabled = anyErrors || !checkValid || !radioValid;
			}
			if (form && submitButton) {
				var fields = form.querySelectorAll('input, textarea');
				fields.forEach(field => {
					field.addEventListener('keyup', function () {
						validateField(field);
					});
				});
			}
		});
	</script>

</body>

</html>